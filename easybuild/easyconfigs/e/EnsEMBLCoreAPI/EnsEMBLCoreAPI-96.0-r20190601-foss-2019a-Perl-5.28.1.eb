easyblock = 'Bundle'

# Ensembl does not provide releases for the Ensembl Core API.
# We take the last available commit of branches "release/96", the last branch not in active development.
name = 'EnsEMBLCoreAPI'
version = '96.0-r20190601'
versionsuffix = '-Perl-%(perlver)s'

homepage = 'https://www.ensembl.org/info/docs/api/index.html'
description = "The Ensembl Core Perl API and SQL schema"

toolchain = {'name': 'foss', 'version': '2019a'}

dependencies = [
    ('Perl', '5.28.1'),
    ('BioPerl', '1.7.2', versionsuffix),
    ('Bio-DB-HTS', '3.01', versionsuffix),
    ('DBD-mysql', '4.050', versionsuffix),
    ('BLAT', '3.5'),        # Needed by Bio::DB::BigFile
    ('snappy', '1.1.7'),    # Needed by Sereal::Decoder
    ('zstd', '1.4.0'),      # Needed by Sereal::Decoder
]

default_easyblock = 'Tarball'
default_component_specs = {
    'source_urls': ['https://github.com/Ensembl/%(name)s/archive'],
    'sources': [{
        'download_filename': '%(version)s.tar.gz',
        'filename': '%%(name)s-%s.tar.gz' % version,
        'extract_cmd': "tar -xzf %s && mv %(name)s-%(version)s %(name)s"
    }],
}

components = [
    ('ensembl', 'af6c2b8d45245c1838461d26238900b1e7125494', {
        'checksums': ['8a23fd7d8952ce0b72379c60d8dca00ff0c0e2da8ca2919dd17be2734e024c3e']}),
    ('ensembl-compara', 'a5dae17c04b97aff76a59dd91c3b2def86c87d21', {
        'checksums': ['c7affd3094429ee135c33e9bb15b13cdac27e353c952108b3fa55a2e203d0ef6']}),
    ('ensembl-variation', '617872b92b3e4b42425286fb0c17ca3f3b961078', {
        'checksums': ['9eaad65b9f758205099bade7d4dda0e9c177a4624e56c002c3cfb906bfe0641d']}),
    ('ensembl-funcgen', 'd9017396c4c1db32430d9334c7461fa2ead52725', {
        'checksums': ['04f586413099d460642f0a590ddd645ff5dbcd3a8ce619ff9d6c6ed6538714e6']}),
    ('ensembl-io', '6e65b3081a69ec930a0ae4beb041398fe839d0fd', {
        'checksums': ['d7cff4b70b9d00080c876220c141e74c762b68b074bac5a1f9a650af5dd34afc']}),
]

# Needed modules installed as proper PerlModule extensions
exts_defaultclass = 'PerlModule'
exts_filter = ("perldoc -lm %(ext_name)s ", "")

exts_list = [
    ('AutoLoader', '5.74', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SM/SMUELLER'],
        'checksums': ['2fac75b05309f71a6871804cd25e1a3ba0a28f43f294fb54528077558da3aff4'],
    }),
    ('Bio::DB::BigFile', '1.07', {
        'preconfigopts': "export KENT_SRC=$EBROOTBLAT MACHTYPE='x86_64' && ",
        'source_tmpl': 'Bio-BigFile-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/L/LD/LDS'],
        'checksums': ['277b66ce8acbdd52399e2c5a0cf4e3bd5c74c12b94877cd383d0c4c97740d16d'],
    }),
    ('CGI', '4.44', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/L/LE/LEEJO'],
        'checksums': ['12435fb7ebd3585c47b6d60ee4f5c7d6a7c114a2827d2b5acf3d62aa9fcf1208'],
    }),
    ('constant', '1.33', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/R/RJ/RJBS'],
        'checksums': ['79965d4130eb576670e27ca0ae6899ef0060c76da48b02b97682166882f1b504'],
    }),
    ('Config::IniFiles', '3.000002', {
        'source_tmpl': 'Config-IniFiles-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SH/SHLOMIF'],
        'checksums': ['d92ed6ed2db98d5addf732c96d2a9c15d9f878c7e8b355bb7a5c1668e3f8ba09'],
    }),
    ('Cwd', '3.75', {
        'source_tmpl': 'PathTools-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/X/XS/XSAWYERX'],
        'checksums': ['a558503aa6b1f8c727c0073339081a77888606aa701ada1ad62dd9d8c3f945a2'],
    }),
    ('Data::Dumper', '2.173', {
        'source_tmpl': 'Data-Dumper-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/X/XS/XSAWYERX'],
        'checksums': ['697608b39330988e519131be667ff47168aaaaf99f06bd2095d5b46ad05d76fa'],
    }),
    ('Data::Predicate', '2.1.1', {
        'source_tmpl': 'Data-Predicate-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/A/AY/AYATES/data'],
        'checksums': ['26d40a54dd3ba3409e847562ef2564a5598bfb3f81c7bd784b608d9bf2222173'],
    }),
    ('Digest::base', '1.16', {
        'source_tmpl': 'Digest-1.17.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/G/GA/GAAS'],
        'checksums': ['2f6a54459fc7f37c0669d548bb224b695eb8d2ddc089aa5547645ce1f5fd86f7'],
    }),
    ('Digest::MD5', '2.55', {
        'source_tmpl': 'Digest-MD5-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/G/GA/GAAS'],
        'checksums': ['03b198a2d14425d951e5e50a885d3818c3162c8fe4c21e18d7798a9a179d0e3c'],
    }),
    ('Encode', '3.01', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/D/DA/DANKOGAI'],
        'checksums': ['d4555f570491648dbbd602bce7966672834b4c8f45acaa6757de474fca3a4d87'],
    }),
    ('Exporter', '5.73', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/T/TO/TODDR'],
        'checksums': ['c5b6e96b0bda7af81c6b444171045cc614fd1f409358ebc810d55f053c8dcde9'],
    }),
    ('ExtUtils::CBuilder', '0.280231', {
        'source_tmpl': 'ExtUtils-CBuilder-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/A/AM/AMBS'],
        'checksums': ['e6e72546ca0468c10bb50d4aba2a9b3908e9fe4d7708e7ee800327be075eeeeb'],
    }),
    ('ExtUtils::CppGuess', '0.19', {
        'source_tmpl': 'ExtUtils-CppGuess-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/E/ET/ETJ'],
        'checksums': ['4cc631bab662848ea7c8899e0c62cdfdb367f2fe205b5bd85dfc1082672a6ad3'],
    }),
    ('ExtUtils::MakeMaker', '7.36', {
        'source_tmpl': 'ExtUtils-MakeMaker-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['06cef6429315cdc6afa9b2dc6fbdfa33538b6f68c827f441294621858e28c558'],
    }),
    ('ExtUtils::ParseXS', '3.35', {
        'source_tmpl': 'ExtUtils-ParseXS-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SM/SMUELLER'],
        'checksums': ['41def0511278a2a8ba9afa25ccab45b0453f75e7fd774e8644b5f9a57cc4ee1c'],
    }),
    ('HTML::Entities', '3.69', {
        'source_tmpl': 'HTML-Parser-3.72.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/G/GA/GAAS'],
        'checksums': ['ec28c7e1d9e67c45eca197077f7cdc41ead1bb4c538c7f02a3296a4bb92f608b'],
    }),
    ('HTML::Template', '2.97', {
        'source_tmpl': 'HTML-Template-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SA/SAMTREGAR'],
        'checksums': ['6547af61f3aa85793f8616190938d677d7995fb3b720c16258040bc935e2129f'],
    }),
    ('IO::File', '1.39', {
        'source_tmpl': 'IO-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/T/TO/TODDR'],
        'checksums': ['4f0502e7f123ac824188eb8873038aaf2ddcc29f8babc1a0b2e1cd34b55a1fca'],
    }),
    ('IO::Scalar', '2.111', {
        'source_tmpl': 'IO-stringy-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/D/DS/DSKOLL'],
        'checksums': ['8c67fd6608c3c4e74f7324f1404a856c331dbf48d9deda6aaa8296ea41bf199d'],
    }),
    ('IO::Select', '1.39', {
        'source_tmpl': 'IO-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/T/TO/TODDR'],
        'checksums': ['4f0502e7f123ac824188eb8873038aaf2ddcc29f8babc1a0b2e1cd34b55a1fca'],
    }),
    ('IO::Socket', '1.39', {
        'source_tmpl': 'IO-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/T/TO/TODDR'],
        'checksums': ['4f0502e7f123ac824188eb8873038aaf2ddcc29f8babc1a0b2e1cd34b55a1fca'],
    }),
    ('IPC::Cmd', '1.02', {
        'source_tmpl': 'IPC-Cmd-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['502129252aabce96e5442143c4363dc7440b6dcf1a79a7fd245908b62f067063'],
    }),
    ('List::Compare', '0.53', {
        'source_tmpl': 'List-Compare-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/J/JK/JKEENAN'],
        'checksums': ['fdbf4ff67b3135d44475fef7fcac0cd4706407d5720d26dca914860eb10f8550'],
    }),
    ('Locale::Maketext::Simple', '0.21', {
        'source_tmpl': 'Locale-Maketext-Simple-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/J/JE/JESSE'],
        'checksums': ['b009ff51f4fb108d19961a523e99b4373ccf958d37ca35bf1583215908dca9a9'],
    }),
    ('MIME::Base64', '3.15', {
        'source_tmpl': 'MIME-Base64-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/G/GA/GAAS'],
        'checksums': ['7f863566a6a9cb93eda93beadb77d9aa04b9304d769cea3bb921b9a91b3a1eb9'],
    }),
    ('Module::CoreList', '5.20190524', {
        'source_tmpl': 'Module-CoreList-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['01cb835843da4ff9c626cb6ea622f0c10eed1ef28ee7802012015d55a4cff428'],
    }),
    ('Module::Load', '0.34', {
        'source_tmpl': 'Module-Load-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['7f5b0c4d3cc8ba867639bff61ad857a940970ea246dd3b0a6729dd7fc84059f3'],
    }),
    ('Module::Load::Conditional', '0.68', {
        'source_tmpl': 'Module-Load-Conditional-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['7627b55cd94a2f1a4667f9203e2c990cad015bf34ec6b41b4f73af848f0698fd'],
    }),
    ('Module::Metadata', '1.000036', {
        'source_tmpl': 'Module-Metadata-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/E/ET/ETHER'],
        'checksums': ['1c70e438cec1f7f99a5cccd4529efb4ee0fb7ca958ca885ebf09952015b957aa'],
    }),
    ('Net::Domain', '3.11', {
        'source_tmpl': 'libnet-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SH/SHAY'],
        'checksums': ['2fab1e4d6e565c77f6e845368790de65cb2f966fcd9bb56a41d0e7b5851a52d3'],
    }),
    ('Params::Check', '0.38', {
        'source_tmpl': 'Params-Check-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/B/BI/BINGOS'],
        'checksums': ['f0c9d33876c36b1bca1475276d26d2efaf449b256d7cc8118fae012e89a26290'],
    }),
    ('parent', '0.237', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/C/CO/CORION'],
        'checksums': ['1089d9648565c1d1e655fa4cb603272d3126747b7b5f836ffee685e27e53caae'],
    }),
    ('Perl::OSType', '1.010', {
        'source_tmpl': 'Perl-OSType-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/D/DA/DAGOLDEN'],
        'checksums': ['e7ed4994b5d547cb23aadb84dc6044c5eb085d5a67a6c5624f42542edd3403b2'],
    }),
    ('Pod::Escapes', '1.07', {
        'source_tmpl': 'Pod-Escapes-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/N/NE/NEILB'],
        'checksums': ['dbf7c827984951fb248907f940fd8f19f2696bc5545c0a15287e0fbe56a52308'],
    }),
    ('Pod::Man', '4.12', {
        'source_tmpl': 'podlators-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/R/RR/RRA'],
        'checksums': ['948717da19630a5f003da4406da90fe1cbdec9ae493671c90dfb6d8b3d63b7eb'],
    }),
    ('Pod::Simple', '3.38', {
        'source_tmpl': 'Pod-Simple-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/K/KH/KHW'],
        'checksums': ['8bbab30c10a671b7d05f3f59f3ef5080ee15d091d47917b7717e6f09a0a38dc3'],
    }),
    ('Scalar::Util', '1.50', {
        'source_tmpl': 'Scalar-List-Utils-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/P/PE/PEVANS'],
        'checksums': ['06aab9c693380190e53be09be7daed20c5d6278f71956989c24cca7782013675'],
    }),
    ('Set::IntervalTree', '0.12', {
        'source_tmpl': 'Set-IntervalTree-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SL/SLOYD'],
        'checksums': ['6fd4000e4022968e2ce5b83c07b189219ef1925ecb72977b52a6f7d76adbc349'],
    }),
    ('Sereal', '4.007', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/Y/YV/YVES'],
        'checksums': ['450e43072e8e5afc0402f81008ca9f1d3d8d4377ff8105cff10aef96be769a59'],
    }),
    ('Sereal::Decoder', '4.007', {
        'source_tmpl': 'Sereal-Decoder-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/Y/YV/YVES'],
        'checksums': ['0508118344682c22e179e85e69bb0771fb0af2965cfa5d7a7d5d097b69ffcc4b'],
    }),
    ('Sereal::Encoder', '4.007', {
        'source_tmpl': 'Sereal-Encoder-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/Y/YV/YVES'],
        'checksums': ['bf6fdddc8fcc901c78adcfb61f56c393cd64d73ab320195ebae9e4a82976eab6'],
    }),
    ('Socket', '2.029', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/P/PE/PEVANS'],
        'checksums': ['3a8d1710a28bf5d7bc46737e43e83657ed4b1c1842efc4cde06c9dd3f6831f06'],
    }),
    ('Storable', '3.15', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/X/XS/XSAWYERX'],
        'checksums': ['fc3dad06cb2e6fc86a2f2abc5b5491d9da328ca3e6b6306559c224521db174da'],
    }),
    ('String::Approx', '3.28', {
        'source_tmpl': 'String-Approx-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/J/JH/JHI'],
        'checksums': ['43201e762d8699cb0ac2c0764a5454bdc2306c0771014d6c8fba821480631342'],
    }),
    ('Test', '1.26', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/J/JE/JESSE'],
        'checksums': ['f7701bd28e05e7f82fe9a181bbab38f53fa6aeae48d2a810da74d1b981d4f392'],
    }),
    ('Test::More', '1.302162', {
        'source_tmpl': 'Test-Simple-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/E/EX/EXODIST'],
        'checksums': ['73a0197c3d735e060881da509f4c5fa76c4cbf7dbabd4297d3cf5f5feed31fc4'],
    }),
    ('Text::ParseWords', '3.30', {
        'source_tmpl': 'Text-ParseWords-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/C/CH/CHORNY'],
        'checksums': ['85e0238179dd43997e58c66bd51611182bc7d533505029a2db0d3232edaff5e8'],
    }),
    ('Text::Wrap', '2013.0523', {
        'source_tmpl': 'Text-Tabs+Wrap-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/M/MU/MUIR/modules'],
        'checksums': ['b9cb056fffb737b9c12862099b952bf4ab4b1f599fd34935356ae57dab6f655f'],
    }),
    ('Time::Local', '1.28', {
        'source_tmpl': 'Time-Local-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/D/DR/DROLSKY'],
        'checksums': ['9278b9e5cc99dcbb0fd27a43e914828b59685601edae082889b5ee7266afe10e'],
    }),
    ('URI::Escape', '3.31', {
        'source_tmpl': 'URI-1.76.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/O/OA/OALDERS'],
        'checksums': ['b2c98e1d50d6f572483ee538a6f4ccc8d9185f91f0073fd8af7390898254413e'],
    }),
    ('XML::Writer', '0.625', {
        'source_tmpl': 'XML-Writer-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/J/JO/JOSEPHW'],
        'checksums': ['e080522c6ce050397af482665f3965a93c5d16f5e81d93f6e2fe98084ed15fbe'],
    }),
    ('XSLoader', '0.24', {
        'source_tmpl': '%(name)s-%(version)s.tar.gz',
        'source_urls': ['https://cpan.metacpan.org/authors/id/S/SA/SAPER'],
        'checksums': ['e819a35a6b8e55cb61b290159861f0dc00fe9d8c4f54578eb24f612d45c8d85f'],
    }),
]

# This is highly unorthodox, but there is tiny piece of C that needs to be compiled
postinstallcmds = ["cd %(installdir)s/ensembl-variation/C_code && HTSLIB_DIR=$EBROOTHTSLIB/include make"]

sanity_check_paths = {
    'files': [],
    'dirs': ['ensembl/modules', 'ensembl-compara/modules', 'ensembl-funcgen/modules',
             'ensembl-variation/modules', 'ensembl-io/modules', 'lib/perl5/site_perl/%(perlver)s/'],
}

modextrapaths = {
    'PERL5LIB': ['ensembl/modules', 'ensembl-compara/modules', 'ensembl-funcgen/modules',
                 'ensembl-variation/modules', 'ensembl-io/modules', 'lib/perl5/site_perl/%(perlver)s/'],
    'HTSLIB_DIR': "$EBROOTHTSLIB/include",
}

moduleclass = 'bio'
